<div class="mb-3">
  <span class="text-muted" *ngIf="(quoteList$ | async)?.length > 0">{{'MY_ACCOUNT.QUOTE_DETAIL.TOTAL_QUOTES' | translate}}: <strong>{{quoteAggregate?.total_records}}</strong> | {{'COMMON.AMOUNT' | translate}}: <strong>{{totalQuoteAmount | localCurrency | async}}</strong></span>
</div>
<div class="row">
  <div class="col-12 col-md-6">
    <div class="card-header border">
      <strong class="text-uppercase d-block">{{'MY_ACCOUNT.QUOTE_DETAIL.QUOTES_BY_STATUS' | translate}}</strong>
    </div>
    <div class="card-body border border-top-0">
      <apt-chart [data]="quotesByStatus" [type]="'bar'" [showLegend]="false"></apt-chart>
    </div>
  </div>
  <div class="col-12 col-md-6">
    <div class="card-header border">
      <strong class="text-uppercase d-block">{{'MY_ACCOUNT.QUOTE_DETAIL.QUOTES_BY_DUE_DATE' | translate}}</strong>
    </div>
    <div class="card-body border border-top-0">
      <apt-chart [data]="quotesByDueDate" [type]="'doughnut'" [legendPosition]="'right'" [colorPalette]="colorPalette" [centerText]="quoteAggregate?.total_records"></apt-chart>
    </div>
  </div>
</div>

<div *ngIf="(quoteList$ | async) as quoteList; else loading"  class="card p-0 mt-3">
  <table class="table table-striped">
    <thead>
      <tr>
        <th scope="col"><apt-output-field [record]="quote" [field]="'Name'" [editable]="false" [labelOnly]="true"></apt-output-field></th>
        <th scope="col"><apt-output-field [record]="quote" [field]="'Proposal_Name'" [editable]="false" [labelOnly]="true"></apt-output-field></th>
        <th scope="col">{{'COMMON.TOTAL_AMOUNT' | translate}}</th>
        <th scope="col"><apt-output-field [record]="quote" [field]="'Account.Owner.Name'" [editable]="false" [labelOnly]="true" [label]="'Assigned To'"></apt-output-field></th>
        <th scope="col"><apt-output-field [record]="quote" [field]="'CreatedDate'" [editable]="false" [labelOnly]="true"></apt-output-field></th>
        <th scope="col"><apt-output-field [record]="quote" [field]="'RFP_Response_Due_Date'" [editable]="false" [labelOnly]="true"></apt-output-field></th>
        <th scope="col"><apt-output-field [record]="quote" [field]="'Account.PriceList.Name'" [editable]="false" [labelOnly]="true" [label]="'Price List'"></apt-output-field></th>
        <th scope="col"><apt-output-field [record]="quote" [field]="'Approval_Stage'" [editable]="false" [labelOnly]="true"></apt-output-field></th>
        <!-- <th scope="col">&nbsp;</th> -->
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let quote of quoteList">
        <th scope="row">
          <a href="javascript:void(0)" [routerLink]="['/Proposals', quote.Id]">
            {{quote.Name}}
          </a>
        </th>
        <td>{{quote?.Proposal_Name}}</td>
        <td><apt-price [record]="quote"></apt-price></td>
        <td>{{quote?.Owner?.Name}}</td>
        <td>{{quote?.CreatedDate | date : 'shortDate'}}</td>
        <td>{{quote?.RFP_Response_Due_Date | date : 'shortDate'}}</td>
        <td>{{quote?.Account?.PriceList?.Name}}</td>
        <td>
          <span [class]="'badge w-100 badge-' + (actionConfiguration[quote.Approval_Stage] ? actionConfiguration[quote.Approval_Stage]?.color : 'info')">{{quote.Approval_Stage}}</span>
        </td>
        <!-- 
          Commented as these actions are not yet implemented
        -->
        <!-- <td dropdown container="body">
          <button class="btn btn-link p-0 dropdown-toggle" dropdownToggle data-spinner-color="black" data-style="zoom-in">
            <span class="oi oi-ellipses vertical"></span>
          </button>
          <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu" role="menu" aria-labelledby="button-basic">
            <li role="menuitem" *ngFor="let action of actionConfiguration[quote.Approval_Stage]?.actions">
              <a class="dropdown-item" href="javascript:void(0)" (click)="action.action(quote)">{{action.label}}</a>
            </li><li class="divider dropdown-divider"></li>
            <li role="menuitem" *ngIf="actionConfiguration[quote.Approval_Stage].allowDelete">
              <a class="dropdown-item text-danger" href="javascript:void(0)" (click)="delete(quote)">Delete</a>
            </li>
          </ul>
        </td> -->
      </tr>
    </tbody>
  </table>
</div>
<div class="d-flex justify-content-center mt-3">
  <pagination [totalItems]="quoteAggregate?.total_records" [(ngModel)]="currentPage" (pageChanged)="loadQuotes($event.page)"
  [firstText]="paginationButtonLabels.first" [previousText]="paginationButtonLabels.previous" [nextText]="paginationButtonLabels.next" 
  [lastText]="paginationButtonLabels.last"></pagination>
</div>
<ng-template #loading>
  <div class="d-flex justify-content-center py-5">
    <apt-md-spinner></apt-md-spinner>
  </div>
</ng-template>