<div class="container-fluid py-4" id="top">
  <apt-breadcrumb [sobject]="category"></apt-breadcrumb>
  <div class="row">
    <div class="col-12 col-lg-3">
      <div>
        <pl-related-categories [categoryList]="searchResults?.relatedCategories" class="d-block mb-2" *ngIf="searchResults?.relatedCategories?.length > 0"
          [categoryId]="category?.Id"></pl-related-categories>
          
        <pl-subcategory (onFilterChange)="onSubcategoryFilter($event)" *ngIf="subCategories?.length > 0 || searchResults?.subcategories?.length > 0"
          [categoryList]="subCategories || searchResults?.subcategories" [categories]="categoryFilter" class="d-block mb-2"></pl-subcategory>

        <pl-price-tier [data]="searchResults?.totals" [tier]="priceTier" class="d-block mb-2" (onPriceChange)="onPriceTierChange($event)"></pl-price-tier>
        <pl-field-filter [fieldName]="'Family'" (fieldValueChange)="onFieldFilter($event)" class="d-block mb-2"></pl-field-filter>
      </div>
    </div>
    <div class="col-12 col-lg-9">
      <nav class="navbar navbar-light bg-white p-0 mb-3">
        <pl-results [recordCount]="searchResults?.filteredTotals?.total_records" [limit]="pageSize" [offset]="(page - 1) * pageSize"
          [page]="page" [view]="view" [query]="query" (onViewChange)="view = $event" (onSortChange)="onSortChange($event)" (onPageSizeChange) = "onPageSizeChange($event)"
          class="d-block w-100">
        </pl-results>
      </nav>

      <div class="d-flex justify-content-center my-5 py-5" *ngIf="!searchResults?.productList">
        <apt-md-spinner></apt-md-spinner>
      </div>

      <div class="row" *ngIf="view == 'grid' && searchResults?.productList">
        <div class="col-12 col-sm-6 col-md-4 col-xl-3" *ngFor="let product of searchResults?.productList">
          <apt-cr-product-card [product]="product" [constraintRuleList]="constraintRules" class="mb-3"></apt-cr-product-card>
        </div>
      </div>
      <div class="row" *ngIf="view == 'list' && searchResults?.productList">
        <div class="col-12">
          <ul class="list-unstyled list-groupo">
            <li *ngFor="let product of searchResults?.productList" class="list-group-item">
              <apt-cr-product-card [product]="product" [constraintRuleList]="constraintRules" type="media"></apt-cr-product-card>
            </li>
          </ul>
        </div>
      </div>
      <div class="d-flex justify-content-center" *ngIf="searchResults?.productList">
        <pagination *ngIf="searchResults" (pageChanged)="onPage($event)" [totalItems]="searchResults?.filteredTotals?.total_records"
          [(ngModel)]="page" [boundaryLinks]="true" [itemsPerPage]="pageSize" [maxSize]="5"></pagination>
      </div>
    </div>
  </div>
</div>